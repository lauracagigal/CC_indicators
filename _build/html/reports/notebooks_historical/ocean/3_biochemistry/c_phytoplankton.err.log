Traceback (most recent call last):
  File "/Users/laurac/opt/anaconda3/envs/cc_indicators_v2/lib/python3.12/site-packages/jupyter_cache/executors/utils.py", line 58, in single_nb_execution
    executenb(
  File "/Users/laurac/opt/anaconda3/envs/cc_indicators_v2/lib/python3.12/site-packages/nbclient/client.py", line 1319, in execute
    return NotebookClient(nb=nb, resources=resources, km=km, **kwargs).execute()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/laurac/opt/anaconda3/envs/cc_indicators_v2/lib/python3.12/site-packages/jupyter_core/utils/__init__.py", line 165, in wrapped
    return loop.run_until_complete(inner)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/laurac/opt/anaconda3/envs/cc_indicators_v2/lib/python3.12/asyncio/base_events.py", line 664, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/Users/laurac/opt/anaconda3/envs/cc_indicators_v2/lib/python3.12/site-packages/nbclient/client.py", line 709, in async_execute
    await self.async_execute_cell(
  File "/Users/laurac/opt/anaconda3/envs/cc_indicators_v2/lib/python3.12/site-packages/nbclient/client.py", line 1062, in async_execute_cell
    await self._check_raise_for_error(cell, cell_index, exec_reply)
  File "/Users/laurac/opt/anaconda3/envs/cc_indicators_v2/lib/python3.12/site-packages/nbclient/client.py", line 918, in _check_raise_for_error
    raise CellExecutionError.from_cell_and_msg(cell, exec_reply_content)
nbclient.exceptions.CellExecutionError: An error occurred while executing the following cell:
------------------
data_y = data_xr.resample(time='1YE').mean()
fig = plot_map_subplots(data_y, 'MD50', shp_eez = shp_eez, cmap = 'YlGnBu', vmin = 0.4, vmax = 1.6, cbar = 1)
------------------


[0;31m---------------------------------------------------------------------------[0m
[0;31mUnboundLocalError[0m                         Traceback (most recent call last)
Cell [0;32mIn[7], line 2[0m
[1;32m      1[0m data_y [38;5;241m=[39m data_xr[38;5;241m.[39mresample(time[38;5;241m=[39m[38;5;124m'[39m[38;5;124m1YE[39m[38;5;124m'[39m)[38;5;241m.[39mmean()
[0;32m----> 2[0m fig [38;5;241m=[39m [43mplot_map_subplots[49m[43m([49m[43mdata_y[49m[43m,[49m[43m [49m[38;5;124;43m'[39;49m[38;5;124;43mMD50[39;49m[38;5;124;43m'[39;49m[43m,[49m[43m [49m[43mshp_eez[49m[43m [49m[38;5;241;43m=[39;49m[43m [49m[43mshp_eez[49m[43m,[49m[43m [49m[43mcmap[49m[43m [49m[38;5;241;43m=[39;49m[43m [49m[38;5;124;43m'[39;49m[38;5;124;43mYlGnBu[39;49m[38;5;124;43m'[39;49m[43m,[49m[43m [49m[43mvmin[49m[43m [49m[38;5;241;43m=[39;49m[43m [49m[38;5;241;43m0.4[39;49m[43m,[49m[43m [49m[43mvmax[49m[43m [49m[38;5;241;43m=[39;49m[43m [49m[38;5;241;43m1.6[39;49m[43m,[49m[43m [49m[43mcbar[49m[43m [49m[38;5;241;43m=[39;49m[43m [49m[38;5;241;43m1[39;49m[43m)[49m

File [0;32m~/Library/Mobile Documents/com~apple~CloudDocs/Projects/CC_indicators/CC_indicators/notebooks_historical/ocean/3_biochemistry/../../../../indicators_setup/ind_setup/plotting.py:282[0m, in [0;36mplot_map_subplots[0;34m(data_an, var, shp_eez, cmap, vmin, vmax, sub_plot, figsize, cbar, cbar_pad, titles)[0m
[1;32m    280[0m ax [38;5;241m=[39m axs[i]
[1;32m    281[0m [38;5;28;01mif[39;00m i [38;5;241m<[39m [38;5;28mlen[39m(data_an[dim_plot]):
[0;32m--> 282[0m     ax [38;5;241m=[39m [43mplot_base_map[49m[43m([49m[43mshp_eez[49m[38;5;241;43m=[39;49m[43mshp_eez[49m[43m,[49m[43m [49m[43max[49m[43m [49m[38;5;241;43m=[39;49m[43m [49m[43max[49m[43m)[49m
[1;32m    283[0m     [38;5;28;01mtry[39;00m:
[1;32m    284[0m         im [38;5;241m=[39m ax[38;5;241m.[39mpcolor(data_year[38;5;241m.[39mlongitude, data_year[38;5;241m.[39mlatitude, data_year[var], transform[38;5;241m=[39mccrs[38;5;241m.[39mPlateCarree(), 
[1;32m    285[0m         cmap[38;5;241m=[39mcmap, vmin[38;5;241m=[39mvmin, vmax[38;5;241m=[39mvmax)

File [0;32m~/Library/Mobile Documents/com~apple~CloudDocs/Projects/CC_indicators/CC_indicators/notebooks_historical/ocean/3_biochemistry/../../../../indicators_setup/ind_setup/plotting.py:231[0m, in [0;36mplot_base_map[0;34m(shp_eez, ax, figsize)[0m
[1;32m    229[0m ax[38;5;241m.[39mset_xlabel([38;5;124m'[39m[38;5;124mLongitude[39m[38;5;124m'[39m)
[1;32m    230[0m ax[38;5;241m.[39mset_ylabel([38;5;124m'[39m[38;5;124mLatitude[39m[38;5;124m'[39m)
[0;32m--> 231[0m [38;5;28;01mif[39;00m [43max_initial[49m [38;5;129;01mis[39;00m [38;5;28;01mNone[39;00m:
[1;32m    232[0m     [38;5;28;01mreturn[39;00m fig, ax
[1;32m    233[0m [38;5;28;01melse[39;00m:

[0;31mUnboundLocalError[0m: cannot access local variable 'ax_initial' where it is not associated with a value

